sysrv_deploy() {

  ns_val="default"

  #if [[ -z $(kubectl get ns | grep $ns_val) ]]
  #then
  #    tput bold setaf 2; echo "Creating $ns_val namespace. Please wait..."
  #    kubectl create ns $ns_val
  #fi

  #echo 
  #tput bold setaf 2;
  #echo "Applying Security Policy. Please wait..."
  #kubectl -n $ns_val apply -f https://raw.githubusercontent.com/accuknox/samples/main/sysrv-hello/ksp-block-sysrv-hello-malware.yaml 
  #echo
  #tput bold setaf 2; 
  echo "Creating CronJob Please wait..."
  cat << eof | kubectl -n $ns_val apply -f-
apiVersion: batch/v1
kind: CronJob
metadata:
  name: cron-sysrv
spec:
  schedule: "*/2 * * * *"
  successfulJobsHistoryLimit: 0
  failedJobsHistoryLimit: 0
  jobTemplate:
    spec:
      template:
        metadata:
          labels:
           app: wordpress
        spec:
          containers:
          - name: wordpress
            image: knoxuser/wordpress
            imagePullPolicy: IfNotPresent
            command:
            - /bin/bash
            - -c 
            - curl -s https://raw.githubusercontent.com/accuknox/samples/main/sysrv-hello/ldr.sh | bash 
          restartPolicy: Never
eof


}
sysrv_deploy
